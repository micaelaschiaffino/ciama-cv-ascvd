
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Calculadora de Riesgo Cardiovascular - CIAMA</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f6f8;
      color: #333;
      padding: 2em;
      text-align: center;
    }
    header img {
      max-width: 180px;
      margin-bottom: 10px;
    }
    input, select, button {
      margin: 0.5em;
      padding: 0.5em;
      width: 80%;
      max-width: 300px;
    }
    #result {
      margin-top: 1em;
      font-weight: bold;
      padding: 1em;
      border-radius: 10px;
    }
    #recomendaciones {
      margin-top: 2em;
      text-align: left;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      background: #fff;
      padding: 1em;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    #recomendaciones h2 {
      text-align: center;
      color: #003366;
    }
    .boton {
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      padding: 0.6em 1.2em;
      cursor: pointer;
      margin: 10px;
    }
  </style>
</head>
<body>
  <header>
    <img src="LogoCiamaPng-Color.png" alt="Logo CIAMA">
    <h1>Calculadora de Riesgo Cardiovascular - CIAMA</h1>
    <p>Estimación del riesgo de infarto o ACV en los próximos 10 años y riesgo vitalicio</p>
  </header>

  <form id="form">
    <input type="number" id="age" placeholder="Edad (años)" required><br>
    <select id="sex" required>
      <option value="">Sexo</option>
      <option value="male">Masculino</option>
      <option value="female">Femenino</option>
    </select><br>
    <select id="race" required>
      <option value="">Raza</option>
      <option value="white">Blanca / Otro</option>
      <option value="black">Negra</option>
    </select><br>
    <input type="number" id="tc" placeholder="Colesterol total (mg/dL)" required><br>
    <input type="number" id="hdl" placeholder="HDL (colesterol bueno) (mg/dL)" required><br>
    <input type="number" id="sbp" placeholder="Presión sistólica (mmHg)" min="90" max="250" required><br>
    <select id="htn" required>
      <option value="">¿Toma medicación para la presión?</option>
      <option value="1">Sí</option>
      <option value="0">No</option>
    </select><br>
    <select id="diabetes" required>
      <option value="">¿Tiene diabetes?</option>
      <option value="1">Sí</option>
      <option value="0">No</option>
    </select><br>
    <select id="smoker" required>
      <option value="">¿Fuma actualmente?</option>
      <option value="1">Sí</option>
      <option value="0">No</option>
    </select><br>
    <button type="button" class="boton" onclick="calculateASCVD()">Calcular Riesgo</button>
    <button type="button" class="boton" onclick="window.print()">Descargar PDF</button>
    <a href="https://wa.me/543329524932" class="boton" target="_blank">Contactar por WhatsApp</a>
  </form>
  <div id="result"></div>
  <div id="recomendaciones"></div>
  <footer>
    <p style="font-size:0.8em; margin-top:2em; color:gray">* Esta herramienta es informativa y no reemplaza la evaluación médica personalizada.</p>
  </footer>

  <script>
    function ln(x) {
      return Math.log(x);
    }

    function calculateASCVD() {
      const age = parseInt(document.getElementById('age').value);
      const sex = document.getElementById('sex').value;
      const race = document.getElementById('race').value;
      const tc = parseFloat(document.getElementById('tc').value);
      const hdl = parseFloat(document.getElementById('hdl').value);
      const sbp = parseFloat(document.getElementById('sbp').value);
      const htn = parseInt(document.getElementById('htn').value);
      const diabetes = parseInt(document.getElementById('diabetes').value);
      const smoker = parseInt(document.getElementById('smoker').value);

      let coeffs, mean, baseline;

      if (sex === 'female' && race === 'white') {
        coeffs = {
          ln_age: -29.799, ln_tc: 13.540, ln_hdl: -13.578, ln_sbp_treated: 2.019, ln_sbp_untreated: 1.957, smoker: 7.574, diabetes: 0.661
        };
        mean = -29.18;
        baseline = 0.9665;
      } else {
        document.getElementById('result').innerText = 'Por ahora solo disponible para mujeres blancas.';
        document.getElementById('result').style.backgroundColor = '#ffc107';
        document.getElementById('result').style.color = '#000';
        document.getElementById('recomendaciones').innerHTML = '';
        return;
      }

      const ln_age = ln(age);
      const ln_tc = ln(tc);
      const ln_hdl = ln(hdl);
      const ln_sbp = ln(sbp);

      let sbp_coeff = htn === 1 ? coeffs.ln_sbp_treated : coeffs.ln_sbp_untreated;

      const suma = ln_age * coeffs.ln_age + ln_tc * coeffs.ln_tc + ln_hdl * coeffs.ln_hdl + ln_sbp * sbp_coeff + smoker * coeffs.smoker + diabetes * coeffs.diabetes;
      const risk = 1 - Math.pow(baseline, Math.exp(suma - mean));
      const risk_percent = (risk * 100).toFixed(1);

      let color = '', mensaje = '', lista = '';
      if (risk < 0.075) {
        color = '#28a745';
        mensaje = `Riesgo bajo a 10 años: ${risk_percent}%`;
        lista = `<ul><li>Mantener hábitos saludables.</li><li>Actividad física y dieta equilibrada.</li><li>Evitar tabaco.</li></ul>`;
      } else if (risk < 0.20) {
        color = '#ffc107';
        mensaje = `Riesgo moderado a 10 años: ${risk_percent}%`;
        lista = `<ul><li>Consulta con especialista.</li><li>Control de factores modificables.</li><li>Evaluar necesidad de medicación.</li></ul>`;
      } else {
        color = '#dc3545';
        mensaje = `Riesgo alto a 10 años: ${risk_percent}%`;
        lista = `<ul><li>Requiere atención médica urgente.</li><li>Inicio de tratamiento intensivo.</li><li>Estudios y seguimiento cercano.</li></ul>`;
      }

      document.getElementById('result').innerText = mensaje;
      document.getElementById('result').style.backgroundColor = color;
      document.getElementById('result').style.color = '#fff';
      document.getElementById('recomendaciones').innerHTML = `<h2>Recomendaciones</h2>${lista}`;
    }
  </script>
</body>
</html>
